2025-01-11 04:50:27,827 - INFO - Initializing DataProcessor for fine-tuning...
2025-01-11 04:50:38,901 - INFO - Data loaded and processed successfully.
2025-01-11 04:50:38,902 - INFO - Loading label encoder from /data/A-TrajectoryTransformer/models/transformer/mobis/label_encoder.joblib...
2025-01-11 04:50:38,905 - INFO - Label encoder loaded and assigned to DataProcessor.
2025-01-11 04:50:38,905 - INFO - Clearing old sequences and re-creating them using loaded encoder...
2025-01-11 04:50:46,076 - INFO - Sequences re-created successfully.
2025-01-11 04:50:46,077 - INFO - DataLoaders for train, val, and test are ready.
2025-01-11 04:50:46,078 - INFO - Initializing model for fine-tuning...
2025-01-11 04:50:49,434 - INFO - Loading pretrained model from: /data/A-TrajectoryTransformer/models/transformer/mobis/best_model.pth
2025-01-11 04:50:49,448 - INFO - Pretrained model loaded successfully.
2025-01-11 04:50:49,448 - INFO - Unfrozen all layers of the transformer encoder.
2025-01-11 04:50:49,448 - INFO - Optimizer re-initialized to only update unfrozen parameters.
2025-01-11 04:50:49,449 - INFO - Starting the fine-tuning process...
2025-01-11 04:50:52,065 - INFO - [Epoch 1/20] Train Loss: 3.8025, Train Acc: 0.3871, Val Loss: 1.5607, Val Acc: 0.5187
2025-01-11 04:50:52,158 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:50:55,199 - INFO - [Epoch 2/20] Train Loss: 1.1641, Train Acc: 0.5784, Val Loss: 1.2670, Val Acc: 0.6641
2025-01-11 04:50:55,241 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:50:58,902 - INFO - [Epoch 3/20] Train Loss: 0.6900, Train Acc: 0.7464, Val Loss: 0.8008, Val Acc: 0.7529
2025-01-11 04:50:58,932 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:02,545 - INFO - [Epoch 4/20] Train Loss: 0.4490, Train Acc: 0.8476, Val Loss: 0.6404, Val Acc: 0.7993
2025-01-11 04:51:02,593 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:06,235 - INFO - [Epoch 5/20] Train Loss: 0.3525, Train Acc: 0.8721, Val Loss: 0.6526, Val Acc: 0.8107
2025-01-11 04:51:06,266 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:11,085 - INFO - [Epoch 6/20] Train Loss: 0.3388, Train Acc: 0.8810, Val Loss: 0.6524, Val Acc: 0.8157
2025-01-11 04:51:11,151 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:14,863 - INFO - [Epoch 7/20] Train Loss: 0.3681, Train Acc: 0.8732, Val Loss: 0.5387, Val Acc: 0.8439
2025-01-11 04:51:14,895 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:18,498 - INFO - [Epoch 8/20] Train Loss: 0.2399, Train Acc: 0.9110, Val Loss: 0.4980, Val Acc: 0.8573
2025-01-11 04:51:18,589 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:22,429 - INFO - [Epoch 9/20] Train Loss: 0.2075, Train Acc: 0.9244, Val Loss: 0.5013, Val Acc: 0.8594
2025-01-11 04:51:22,501 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:26,596 - INFO - [Epoch 10/20] Train Loss: 0.2033, Train Acc: 0.9299, Val Loss: 0.5167, Val Acc: 0.8615
2025-01-11 04:51:26,660 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:28,951 - INFO - [Epoch 11/20] Train Loss: 0.1708, Train Acc: 0.9410, Val Loss: 0.5527, Val Acc: 0.8594
2025-01-11 04:51:28,951 - INFO -   -> No improvement (1/5)
2025-01-11 04:51:31,253 - INFO - [Epoch 12/20] Train Loss: 0.1525, Train Acc: 0.9388, Val Loss: 0.5419, Val Acc: 0.8610
2025-01-11 04:51:31,254 - INFO -   -> No improvement (2/5)
2025-01-11 04:51:33,569 - INFO - [Epoch 13/20] Train Loss: 0.1487, Train Acc: 0.9466, Val Loss: 0.5474, Val Acc: 0.8636
2025-01-11 04:51:33,619 - INFO -   -> Best fine-tuned model saved.
2025-01-11 04:51:35,949 - INFO - [Epoch 14/20] Train Loss: 0.1278, Train Acc: 0.9488, Val Loss: 0.6085, Val Acc: 0.8606
2025-01-11 04:51:35,949 - INFO -   -> No improvement (1/5)
2025-01-11 04:51:38,295 - INFO - [Epoch 15/20] Train Loss: 0.1249, Train Acc: 0.9488, Val Loss: 0.6248, Val Acc: 0.8601
2025-01-11 04:51:38,296 - INFO -   -> No improvement (2/5)
2025-01-11 04:51:40,628 - INFO - [Epoch 16/20] Train Loss: 0.1031, Train Acc: 0.9600, Val Loss: 0.7008, Val Acc: 0.8409
2025-01-11 04:51:40,629 - INFO -   -> No improvement (3/5)
2025-01-11 04:51:42,923 - INFO - [Epoch 17/20] Train Loss: 0.1241, Train Acc: 0.9444, Val Loss: 0.7070, Val Acc: 0.8314
2025-01-11 04:51:42,923 - INFO -   -> No improvement (4/5)
2025-01-11 04:51:45,264 - INFO - [Epoch 18/20] Train Loss: 0.1864, Train Acc: 0.9166, Val Loss: 0.6587, Val Acc: 0.8400
2025-01-11 04:51:45,265 - INFO -   -> No improvement (5/5)
2025-01-11 04:51:45,265 - INFO - Early stopping triggered.
2025-01-11 04:51:45,265 - INFO - 
Loading best fine-tuned model from finetuned_model.pth for final evaluation...
2025-01-11 04:51:50,950 - INFO - Test Loss: 0.6433, Test Accuracy: 0.8466
2025-01-11 04:51:56,724 - INFO - Classification Report:
              precision    recall  f1-score   support

        bike       0.93      0.77      0.84      9168
         bus       0.89      0.87      0.88     13865
         car       0.65      0.78      0.71      8257
       train       0.76      0.74      0.75     10011
        walk       0.95      0.99      0.97     14462

    accuracy                           0.85     55763
   macro avg       0.84      0.83      0.83     55763
weighted avg       0.85      0.85      0.85     55763

2025-01-11 04:51:57,064 - INFO - Confusion matrix saved as 'confusion_matrix_finetune.png'.
2025-01-11 04:51:57,064 - INFO - Fine-tuning script completed successfully.
