2025-02-03 07:16:10,585 - INFO - Initializing DataProcessor for fine-tuning...
2025-02-03 07:16:21,800 - INFO - Data loaded and processed successfully.
2025-02-03 07:16:21,801 - INFO - Loading label encoder from /data/A-TrajectoryTransformer/models/transformer/mobis/label_encoder.joblib...
2025-02-03 07:16:21,803 - INFO - Label encoder loaded and assigned to DataProcessor.
2025-02-03 07:16:21,803 - INFO - Clearing old sequences and re-creating them using loaded encoder...
2025-02-03 07:16:28,835 - INFO - Sequences re-created successfully.
2025-02-03 07:16:28,837 - INFO - DataLoaders for train, val, and test are ready.
2025-02-03 07:16:28,838 - INFO - Initializing model for fine-tuning...
2025-02-03 07:16:32,647 - INFO - Loading pretrained model from: /data/A-TrajectoryTransformer/models/transformer/mobis/best_model.pth
2025-02-03 07:16:32,726 - INFO - Pretrained model loaded successfully.
2025-02-03 07:16:32,727 - INFO - Unfrozen all layers of the transformer encoder.
2025-02-03 07:16:32,728 - INFO - Optimizer re-initialized to only update unfrozen parameters.
2025-02-03 07:16:32,728 - INFO - Starting the fine-tuning process...
2025-02-03 07:16:35,285 - INFO - [Epoch 1/20] Train Loss: 3.7034, Train Acc: 0.3809, Val Loss: 1.4200, Val Acc: 0.5546
2025-02-03 07:16:35,315 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:16:38,664 - INFO - [Epoch 2/20] Train Loss: 1.0571, Train Acc: 0.6223, Val Loss: 1.1497, Val Acc: 0.6986
2025-02-03 07:16:38,732 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:16:41,987 - INFO - [Epoch 3/20] Train Loss: 0.5960, Train Acc: 0.7908, Val Loss: 0.8563, Val Acc: 0.7498
2025-02-03 07:16:42,035 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:16:45,299 - INFO - [Epoch 4/20] Train Loss: 0.4418, Train Acc: 0.8530, Val Loss: 0.6497, Val Acc: 0.8000
2025-02-03 07:16:45,336 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:16:48,654 - INFO - [Epoch 5/20] Train Loss: 0.3424, Train Acc: 0.8777, Val Loss: 0.6424, Val Acc: 0.8071
2025-02-03 07:16:48,695 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:16:51,994 - INFO - [Epoch 6/20] Train Loss: 0.2913, Train Acc: 0.8948, Val Loss: 0.6574, Val Acc: 0.8053
2025-02-03 07:16:51,995 - INFO -   -> No improvement (1/5)
2025-02-03 07:16:55,390 - INFO - [Epoch 7/20] Train Loss: 0.3000, Train Acc: 0.9034, Val Loss: 0.5685, Val Acc: 0.8293
2025-02-03 07:16:55,417 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:16:58,849 - INFO - [Epoch 8/20] Train Loss: 0.2197, Train Acc: 0.9356, Val Loss: 0.5357, Val Acc: 0.8495
2025-02-03 07:16:58,899 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:17:02,266 - INFO - [Epoch 9/20] Train Loss: 0.1959, Train Acc: 0.9388, Val Loss: 0.5393, Val Acc: 0.8575
2025-02-03 07:17:02,317 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:17:06,185 - INFO - [Epoch 10/20] Train Loss: 0.1733, Train Acc: 0.9367, Val Loss: 0.5753, Val Acc: 0.8463
2025-02-03 07:17:06,185 - INFO -   -> No improvement (1/5)
2025-02-03 07:17:08,452 - INFO - [Epoch 11/20] Train Loss: 0.1578, Train Acc: 0.9378, Val Loss: 0.6006, Val Acc: 0.8504
2025-02-03 07:17:08,453 - INFO -   -> No improvement (2/5)
2025-02-03 07:17:10,713 - INFO - [Epoch 12/20] Train Loss: 0.1394, Train Acc: 0.9560, Val Loss: 0.5959, Val Acc: 0.8535
2025-02-03 07:17:10,714 - INFO -   -> No improvement (3/5)
2025-02-03 07:17:12,990 - INFO - [Epoch 13/20] Train Loss: 0.1411, Train Acc: 0.9582, Val Loss: 0.5982, Val Acc: 0.8572
2025-02-03 07:17:12,991 - INFO -   -> No improvement (4/5)
2025-02-03 07:17:15,255 - INFO - [Epoch 14/20] Train Loss: 0.1386, Train Acc: 0.9506, Val Loss: 0.6111, Val Acc: 0.8609
2025-02-03 07:17:15,292 - INFO -   -> Best fine-tuned model saved.
2025-02-03 07:17:17,548 - INFO - [Epoch 15/20] Train Loss: 0.1083, Train Acc: 0.9549, Val Loss: 0.6871, Val Acc: 0.8469
2025-02-03 07:17:17,548 - INFO -   -> No improvement (1/5)
2025-02-03 07:17:19,797 - INFO - [Epoch 16/20] Train Loss: 0.1118, Train Acc: 0.9539, Val Loss: 0.6942, Val Acc: 0.8446
2025-02-03 07:17:19,797 - INFO -   -> No improvement (2/5)
2025-02-03 07:17:22,021 - INFO - [Epoch 17/20] Train Loss: 0.0855, Train Acc: 0.9646, Val Loss: 0.6765, Val Acc: 0.8475
2025-02-03 07:17:22,021 - INFO -   -> No improvement (3/5)
2025-02-03 07:17:24,272 - INFO - [Epoch 18/20] Train Loss: 0.0928, Train Acc: 0.9624, Val Loss: 0.7290, Val Acc: 0.8384
2025-02-03 07:17:24,273 - INFO -   -> No improvement (4/5)
2025-02-03 07:17:26,468 - INFO - [Epoch 19/20] Train Loss: 0.0823, Train Acc: 0.9689, Val Loss: 0.7467, Val Acc: 0.8395
2025-02-03 07:17:26,468 - INFO -   -> No improvement (5/5)
2025-02-03 07:17:26,470 - INFO - Early stopping triggered.
2025-02-03 07:17:26,470 - INFO - 
Loading best fine-tuned model from finetuned_model.pth for final evaluation...
2025-02-03 07:17:32,265 - INFO - Test Loss: 0.6649, Test Accuracy: 0.8536
2025-02-03 07:17:38,154 - INFO - Classification Report:
              precision    recall  f1-score   support

        bike       0.94      0.75      0.84      9227
         bus       0.87      0.88      0.88     13772
         car       0.68      0.75      0.71      8144
       train       0.78      0.80      0.79     10957
        walk       0.96      0.99      0.97     14650

    accuracy                           0.85     56750
   macro avg       0.84      0.83      0.84     56750
weighted avg       0.86      0.85      0.85     56750

2025-02-03 07:17:38,513 - INFO - Confusion matrix saved as 'confusion_matrix_finetune.png'.
2025-02-03 07:17:38,513 - INFO - Fine-tuning script completed successfully.
